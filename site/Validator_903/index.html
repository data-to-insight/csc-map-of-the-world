
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://data-to-insight.github.io/csc-map-of-the-world/Validator_903/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Quality LAC data beta: Python validator - CSC Map of the World</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/styles.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quality-lac-data-beta-python-validator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CSC Map of the World" class="md-header__button md-logo" aria-label="CSC Map of the World" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CSC Map of the World
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Quality LAC data beta: Python validator
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CSC Map of the World" class="md-nav__button md-logo" aria-label="CSC Map of the World" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CSC Map of the World
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CSC Network
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CSC Search
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about-this-project" class="md-nav__link">
    <span class="md-ellipsis">
      About this project
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Data pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    <span class="md-ellipsis">
      Development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-validators" class="md-nav__link">
    <span class="md-ellipsis">
      Adding validators
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yearly-rule-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Yearly rule updates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publishing-backend-changes-to-the-frontend-live-tool" class="md-nav__link">
    <span class="md-ellipsis">
      Publishing backend changes to the frontend live tool
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#releases" class="md-nav__link">
    <span class="md-ellipsis">
      Releases
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="quality-lac-data-beta-python-validator">Quality LAC data beta: Python validator</h1>
<p><img alt="Build &amp; Test" src="https://github.com/SocialFinanceDigitalLabs/quality-lac-data-beta-validator/actions/workflows/run-tests.yml/badge.svg" />
<a href="https://badge.fury.io/py/quality-lac-data-validator"><img alt="PyPI version" src="https://badge.fury.io/py/quality-lac-data-validator.svg" /></a>
<a href="https://repl.it/github/SocialFinanceDigitalLabs/quality-lac-data-beta-validator"><img alt="Run on Repl.it" src="https://repl.it/badge/github/SocialFinanceDigitalLabs/quality-lac-data-beta-validator" /></a></p>
<p><em>We want to build a tool that improves the quality of data on Looked After Children so that Children’s Services Departments have all the information needed to enhance their services.</em></p>
<p>We believe that a tool that highlights and helps fixing data errors would be valuable for:</p>
<ol>
<li>Reducing the time analysts, business support and social workers spend cleaning data.</li>
<li>Enabling leadership to better use evidence in supporting Looked After Children.</li>
</ol>
<h2 id="about-this-project">About this project</h2>
<p>The aim of this project is to deliver a tool to relieve some of the pain-points
of <a href="https://www.socialfinance.org.uk/blogs/better-data-children-care-building-common-approach">reporting and quality</a> in children's services data. This project
focuses, in particular, on data on looked after children (LAC) and the
<a href="https://www.gov.uk/guidance/children-looked-after-return-guide-to-submitting-data">SSDA903</a> return.</p>
<p>The project consists of a number of related pieces of work:</p>
<ul>
<li><a href="https://903.datatoinsight.org/">Hosted Tool</a></li>
<li><a href="https://github.com/data-to-insight/csc-validator-fe">React &amp; Pyodie Front-End</a></li>
<li><a href="https://github.com/data-to-insight/csc-validator-be-903">Python Validator Engine &amp; Rules</a> [this repo]</li>
<li><a href="https://github.com/SocialFinanceDigitalLabs/quality-lac-data-ref-authorities">Local Authority Reference Data</a></li>
<li><a href="https://github.com/SocialFinanceDigitalLabs/quality-lac-data-ref-postcodes">Postcode Reference Data</a></li>
</ul>
<p>The core parts consist of a <a href="https://www.python.org/">Python</a> validator engine and rules using
<a href="https://pandas.pydata.org/">Pandas</a> with <a href="https://python-poetry.org/">Poetry</a> for dependency management. The tool is targeted
to run either standalone, or in <a href="https://pyodide.org/en/stable/">pyodide</a> in the browser for a zero-install
deployment with offline capabilities.</p>
<p>It provides methods of finding the validation errors defined by the DfE in 903 data.
The validator needs to be provided with a set of input files for the current year and,
optionally, the previous year. These files are coerced into a common format and sent to
each of the validator rules in turn. The validators report on rows not meeting the rules
and a report is provided highlight errors for each row and which fields were included in
the checks.</p>
<h2 id="data-pipeline">Data pipeline</h2>
<ul>
<li>Loading of files</li>
<li>Identification of tables - currently matched on <strong>exact</strong> filename</li>
<li>Conversion of CSV to tabular format - <strong>no type checking</strong></li>
<li>Enrichment of provided data with Postcode distances</li>
<li>Evaluation of rules</li>
<li>Report</li>
</ul>
<h3 id="project-structure">Project Structure</h3>
<p>These are the key files</p>
<pre><code>project
├─── pyproject.toml           - Project details and dependencies
├─── validator903
│    ├─── config.py           - High-level configuration
│    ├─── ingress.py          - Data ingress (handling CSV and XML files)
│    ├─── types.py            - Classes used across the work
│    ├─── validator.py        - The core validator process
│    └─── validators.py       - All individual validator codes
└─── tests                    - Unit tests
</code></pre>
<p>Most of the work from contributors will be in <code>validators.py</code> and the associated testing files under
tests. Please do not submit a pull-request without a comprehensive test.</p>
<h3 id="development">Development</h3>
<p>To run in codespaces, you need to run in a virtual environment, this information can be found in a .txt file in the documentation.</p>
<p>To install the code and dependencies, from the main project directory run:</p>
<pre><code>poetry install
</code></pre>
<p>If this does not work, it might be because you're running the wrong version of Python, the version of Numpy used by the 903 validator is locked at 3.9. The devcontainer and dockerfile should ensure you are running 3.9 and you may simply require a rebuild. If not, ensure you are working in an environment or venv with Python 3.9 as your interpreter.</p>
<h3 id="adding-validators">Adding validators</h3>
<p>Validators are contained in <code>rule_XXX()</code> files in the rules folder, where <code>xxx</code> is the code of the validation rule. Each file contains a <code>validate</code> which defines the rule logic and a <code>test_validate</code> function which runs the validate function on some test data to check that the rule works as expected.
The validator takes a single argument, the <em>datastore</em>, which is a <a href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a> (a dict-like) following the structure below.</p>
<p>The following is the expected structure for the input data that is given to each validator (the <code>dfs</code> object).
You should assume that not all of these keys are present and handle that appropriately.</p>
<p>Any XML uploads are converted into CSV form to give the same inputs.</p>
<pre><code>{
    # This years data
    'Header':   # header dataframe
    'Episodes': # episodes dataframe
    'Reviews':  # reviews dataframe
    'UASC':     # UASC dataframe
    'OC2':      # OC2 dataframe
    'OC3':      # OC3 dataframe
    'AD1':      # AD1 dataframe
    'PlacedAdoption':  # Placed for adoption dataframe
    'PrevPerm': # Previous permanence dataframe
    'Missing':  # Missing dataframe
    'SWEpisodes': # Social Worker Episodes dataframe (new from 2023/24 return) 
    # Last years data
    'Header_last':   # header dataframe
    'Episodes_last': # episodes dataframe
    'Reviews_last':  # reviews dataframe
    'UASC_last':     # UASC dataframe
    'OC2_last':      # OC2 dataframe
    'OC3_last':      # OC3 dataframe
    'AD1_last':      # AD1 dataframe
    'PlacedAdoption_last':  # Placed for adoption dataframe
    'PrevPerm_last': # Previous permanence dataframe
    'Missing_last':  # Missing dataframe
    'SWEpisodes_last': # Social Worker Episodes dataframe (new from 2023/24 return)
    # Metadata
    'metadata': {
        'collection_start': # A datetime with the collection start date (year/4/1)
        'collection_end':   # A datetime with the collection end date (year + 1/4/1)
        'postcodes':        # Postcodes dataframe, columns laua, oseast1m, osnrth1m, pcd
        'localAuthority:    # The local authority code entered (long form, e.g. E07000026)
        'collectionYear':   # The raw collection year string - unlikely to need this (e.g. '2019/20')
    }
}
</code></pre>
<h2 id="yearly-rule-updates">Yearly rule updates</h2>
<p>Each year, the DfE might release specifications of any rules which have been added, modified or deleted. Expanded guidance on how to incorporate these changes can be found in the <a href="https://github.com/data-to-insight/CIN-validator/">landing page (readme.md file) of the CIN validator repo</a>. The CIN and LAC validators have been refactored to resemble each other as much as possible so their overall documentation applies to both tool backends.</p>
<h2 id="publishing-backend-changes-to-the-frontend-live-tool">Publishing backend changes to the frontend live tool</h2>
<p>When bugs are fixed or rules modified, it is necessary to update the tool so that users can have access to the improvements that have been made in the backend. 
Detailed steps on how to do this are spelt out in the README of the children in need data validator.
Read about <a href="https://github.com/data-to-insight/csc-validator-be-cin">making changes available to users</a></p>
<h2 id="releases">Releases</h2>
<p>To build and release a new version, make sure all your unit tests pass.</p>
<p>We use <a href="https://semver.org/">semantic versioning</a>, so update the project version in <a href="./pyproject.toml">pyproject.toml</a> accordingly
and commit, creating a PR. Once the release version is on GitHub, create a GitHub release naming the release with the 
current release name, e.g. 1.0 and the tag with the release name prefixed with a v, i.e. v1.0. Alpha and beta releases 
can be flagged by appending <code>-alpha.&lt;number&gt;</code> and <code>-beta.&lt;number&gt;</code>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="https://unpkg.com/cytoscape@3.24.0/dist/cytoscape.min.js"></script>
      
        <script src="../js/render_graph.js"></script>
      
        <script src="../js/search_tool.js"></script>
      
    
  </body>
</html>